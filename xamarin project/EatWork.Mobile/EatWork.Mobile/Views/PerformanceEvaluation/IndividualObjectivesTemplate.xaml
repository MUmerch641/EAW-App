<?xml version="1.0" encoding="utf-8" ?>
<StackLayout xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:utils="clr-namespace:EatWork.Mobile.Utils"
             xmlns:iconize="clr-namespace:Plugin.Iconize;assembly=Plugin.Iconize"
             xmlns:border="clr-namespace:Syncfusion.XForms.Border;assembly=Syncfusion.Core.XForms"
             xmlns:effects="clr-namespace:Syncfusion.XForms.EffectsView;assembly=Syncfusion.Core.XForms"
             xmlns:expander="clr-namespace:Syncfusion.XForms.Expander;assembly=Syncfusion.Expander.XForms"
             x:Class="EatWork.Mobile.Views.PerformanceEvaluation.IndividualObjectivesTemplate">

    <StackLayout.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles.xaml" />
                <ResourceDictionary Source="../Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style x:Key="HeaderStyle" BasedOn="{StaticResource PriceLabelStyle}" TargetType="Label">
                <Setter Property="FontSize" Value="{DynamicResource Small}" />
                <Setter Property="FontFamily" Value="{DynamicResource SemiBold}" />
                <Setter Property="LineHeight" Value="{OnPlatform Android=1.25, Default=-1}" />
                <Setter Property="TextColor" Value="{DynamicResource Gray-White}" />
                <Setter Property="Margin" Value="0,0" />
            </Style>
        </ResourceDictionary>
    </StackLayout.Resources>

    <StackLayout Margin="0,0,0,0"
                 BindableLayout.ItemsSource="{Binding Holder.ObjectivesDisplay}"
                 x:Name="Details"
                 Grid.Row="1">
        <BindableLayout.ItemTemplate>
            <DataTemplate>

                <utils:CustomShadowFrame Style="{DynamicResource CustomFrameStyle}"
                                         Margin="0,0,0,4"
                                         HorizontalOptions="FillAndExpand"
                                         VerticalOptions="FillAndExpand"
                                         CornerRadius="0"
                                         Padding="0,0"
                                         BorderColor="Transparent">
                    <utils:CustomShadowFrame.Content>

                        <expander:SfExpander HeaderBackgroundColor="{DynamicResource PrimaryColor}"
                                             HeaderIconPosition="End"
                                             IconColor="{DynamicResource Gray-White}"
                                             IsExpanded="True">
                            <expander:SfExpander.Header>
                                <StackLayout Padding="10,12">
                                    <!--PARENT OBJECTIVE-->
                                    <Label Style="{StaticResource HeaderStyle}"
                                           LineBreakMode="TailTruncation">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{DynamicResource StringFlagIcon}"
                                                      FontFamily="{DynamicResource FontAwesomeSolid}"
                                                      FontSize="15" />
                                                <Span Text=" " />
                                                <Span Text="{Binding Header}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </StackLayout>
                            </expander:SfExpander.Header>

                            <expander:SfExpander.Content>
                                <StackLayout Padding="0,0,0,0"
                                             Spacing="1"
                                             BindableLayout.ItemsSource="{Binding ObjectiveDetailHeaderDto}"
                                             x:Name="DetailsList">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>

                                            <expander:SfExpander HeaderBackgroundColor="{DynamicResource GrayShadowBackgroundColor}"
                                                                 HeaderIconPosition="End"
                                                                 IconColor="{DynamicResource Gray-900}"
                                                                 IsExpanded="True">
                                                <expander:SfExpander.Header>
                                                    <StackLayout Padding="0,12">
                                                        <!--GOAL NAME-->
                                                        <Label Style="{DynamicResource DescriptionLabelStyle}"
                                                               FontSize="{DynamicResource Smaller}"
                                                               LineHeight="{OnPlatform Default=-1, Android=1.5}"
                                                               HorizontalOptions="StartAndExpand"
                                                               VerticalOptions="End"
                                                               LineBreakMode="TailTruncation"
                                                               HorizontalTextAlignment="Start"
                                                               FontFamily="{DynamicResource SemiBold}"
                                                               MaxLines="3"
                                                               Margin="0,0"
                                                               IsVisible="{Binding ObjectiveHeader,Converter={utils:EmptyToBoolConverter}}"
                                                               Text="{Binding ObjectiveHeader}"
                                                               Padding="10,0" />

                                                        <!--GOAL NAME-->
                                                        <Label Style="{DynamicResource DescriptionLabelStyle}"
                                                               FontSize="{DynamicResource Smaller}"
                                                               LineHeight="{OnPlatform Default=-1, Android=1.5}"
                                                               HorizontalOptions="StartAndExpand"
                                                               VerticalOptions="End"
                                                               LineBreakMode="TailTruncation"
                                                               HorizontalTextAlignment="Start"
                                                               FontFamily="{DynamicResource SemiBold}"
                                                               MaxLines="3"
                                                               Margin="0,0"
                                                               IsVisible="{Binding ObjectiveHeader,Converter={utils:EmptyToInverseBoolConverter}}"
                                                               Text=" - "
                                                               Padding="10,0" />
                                                    </StackLayout>
                                                </expander:SfExpander.Header>

                                                <expander:SfExpander.Content>
                                                    <StackLayout Padding="0,0,0,0"
                                                                 Spacing="1"
                                                                 BindableLayout.ItemsSource="{Binding ObjectiveDetailDto}"
                                                                 x:Name="DetailsList1">

                                                        <BindableLayout.ItemTemplate>
                                                            <DataTemplate>

                                                                <effects:SfEffectsView Style="{DynamicResource RippleEffectStyle}"
                                                                                       TouchUpCommand="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ViewObjectiveItemCommand}"
                                                                                       TouchUpCommandParameter="{Binding .}">

                                                                    <border:SfBorder BorderColor="Transparent"
                                                                                     BorderWidth="0"
                                                                                     CornerRadius="4">

                                                                        <StackLayout Spacing="5"
                                                                                     VerticalOptions="Start"
                                                                                     Margin="0,0"
                                                                                     Padding="0,5,0,0">
                                                                            <!--OBJECTIVES-->
                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <Label Style="{DynamicResource DescriptionLabelStyle}"
                                                                                       FontSize="{DynamicResource Smaller}"
                                                                                       LineHeight="{OnPlatform Default=-1, Android=1.5}"
                                                                                       HorizontalOptions="StartAndExpand"
                                                                                       VerticalOptions="End"
                                                                                       LineBreakMode="TailTruncation"
                                                                                       HorizontalTextAlignment="Start"
                                                                                       MaxLines="5"
                                                                                       Margin="10,0"
                                                                                       Grid.ColumnSpan="3"
                                                                                       Text="{Binding ObjectiveDescription}" />
                                                                            </Grid>

                                                                            <!--KPI-->
                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <iconize:IconLabel Grid.Column="0"
                                                                                                   Margin="10,0,0,0"
                                                                                                   Style="{DynamicResource IconLabelStyle}"
                                                                                                   Text="{DynamicResource KPIIconString}"
                                                                                                   FontFamily="{StaticResource FontAwesomeSolid}"
                                                                                                   HorizontalOptions="Start"
                                                                                                   VerticalOptions="Start"
                                                                                                   TextColor="{DynamicResource PrimaryColor}" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding KPIName}" />
                                                                            </Grid>

                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <iconize:IconLabel Grid.Column="0"
                                                                                                   Margin="10,0,0,0"
                                                                                                   Style="{DynamicResource IconLabelStyle}"
                                                                                                   Text="{DynamicResource MeasureIconString}"
                                                                                                   FontFamily="{StaticResource FontAwesomeSolid}"
                                                                                                   HorizontalOptions="Start"
                                                                                                   VerticalOptions="Start"
                                                                                                   TextColor="{DynamicResource PrimaryColor}" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding MeasureName}" />
                                                                            </Grid>

                                                                            <!--TARGET GOAL-->
                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <iconize:IconLabel Grid.Column="0"
                                                                                                   Margin="10,0,0,0"
                                                                                                   Style="{DynamicResource IconLabelStyle}"
                                                                                                   Text="{DynamicResource TargetGoalIconString}"
                                                                                                   FontFamily="{StaticResource FontAwesomeSolid}"
                                                                                                   HorizontalOptions="Start"
                                                                                                   VerticalOptions="Start"
                                                                                                   TextColor="{DynamicResource PrimaryColor}" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding TargetGoalSetup}" />
                                                                            </Grid>

                                                                            <!--WEIGHT-->
                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <iconize:IconLabel Grid.Column="0"
                                                                                                   Margin="10,0,0,0"
                                                                                                   Style="{DynamicResource IconLabelStyle}"
                                                                                                   Text="{DynamicResource WeightIconString}"
                                                                                                   FontFamily="{StaticResource FontAwesomeSolid}"
                                                                                                   HorizontalOptions="Start"
                                                                                                   VerticalOptions="Start"
                                                                                                   TextColor="{DynamicResource PrimaryColor}" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding Weight}" />
                                                                            </Grid>

                                                                            <!--BASELINE-->
                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <iconize:IconLabel Grid.Column="0"
                                                                                                   Margin="10,0,0,0"
                                                                                                   Style="{DynamicResource IconLabelStyle}"
                                                                                                   Text="{DynamicResource BaselineIconString}"
                                                                                                   FontFamily="{StaticResource FontAwesomeSolid}"
                                                                                                   HorizontalOptions="Start"
                                                                                                   VerticalOptions="Start"
                                                                                                   TextColor="{DynamicResource PrimaryColor}" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding BaseLine}" />
                                                                            </Grid>

                                                                            <!--Review-->
                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <Label Grid.Column="0"
                                                                                       Margin="10,0,0,0"
                                                                                       Style="{StaticResource LabelStyleMyScheduleForLabel}"
                                                                                       Text="Review:"
                                                                                       FontFamily="{DynamicResource SemiBold}"
                                                                                       TextColor="{DynamicResource PrimaryColor}"
                                                                                       HorizontalOptions="Start"
                                                                                       VerticalOptions="Start" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding EmployeeReview}" />

                                                                                <!--<control:SfTextInputLayout Style="{DynamicResource InputLayoutStyleEditor}"
                                                                                     Hint=""
                                                                                     Grid.Column="1"
                                                                                     Margin="0,0,10,0">
                                                                                     
                                                                                     <Label Grid.Column="1"
                                                                                     Style="{StaticResource LabelStyleMySchedule}"
                                                                                     FontFamily="{DynamicResource Medium}"
                                                                                     Text="{Binding EmployeeReview}" />
                                                                                     
                                                                                     <Editor FontSize="{DynamicResource Small}"
                                                                                     Text="{Binding EmployeeReview,Mode=TwoWay}"
                                                                                     FontFamily="{DynamicResource Regular}"
                                                                                     IsTextPredictionEnabled="True"
                                                                                     AutoSize="TextChanges"
                                                                                     HeightRequest="{OnPlatform Android=40, iOS=35, UWP=35}"
                                                                                     TextColor="{StaticResource Gray-800}">
                                                                                     <Editor.Behaviors>
                                                                                     <utils:EventToCommandBehavior Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.OnFocusCommand}"
                                                                                     CommandParameter="{Binding .}"
                                                                                     EventName="Focused" />
                                                                                     
                                                                                     <utils:EventToCommandBehavior Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.UnFocusReviewCommand}"
                                                                                     CommandParameter="{Binding EmployeeReview}"
                                                                                     EventName="Unfocused" />
                                                                                     </Editor.Behaviors>
                                                                                     </Editor>
                                                                                     </control:SfTextInputLayout>-->
                                                                            </Grid>

                                                                            <!--ACTUAL-->
                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <Label Grid.Column="0"
                                                                                       Margin="10,0,0,0"
                                                                                       Style="{StaticResource LabelStyleMyScheduleForLabel}"
                                                                                       Text="Actual:"
                                                                                       FontFamily="{DynamicResource SemiBold}"
                                                                                       TextColor="{DynamicResource PrimaryColor}"
                                                                                       HorizontalOptions="Start"
                                                                                       VerticalOptions="Start" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding Actual}" />

                                                                                <!--<control:SfTextInputLayout Style="{DynamicResource InputLayoutStyleEditor}"
                                                                                     Hint=""
                                                                                     Grid.Column="1"
                                                                                     Margin="0,0,10,0">
                                                                                     
                                                                                     <Editor FontSize="{DynamicResource Small}"
                                                                                     Text="{Binding Actual,Mode=TwoWay}"
                                                                                     FontFamily="{DynamicResource Regular}"
                                                                                     IsTextPredictionEnabled="True"
                                                                                     AutoSize="TextChanges"
                                                                                     HeightRequest="{OnPlatform Android=40, iOS=35, UWP=35}"
                                                                                     TextColor="{StaticResource Gray-800}" />
                                                                                     </control:SfTextInputLayout>-->
                                                                            </Grid>

                                                                            <Grid ColumnSpacing="0"
                                                                                  RowSpacing="0"
                                                                                  Margin="0,5,0,0"
                                                                                  Style="{StaticResource GridMyScheduleDetails}">

                                                                                <Label Grid.Column="0"
                                                                                       Margin="10,0,0,0"
                                                                                       Style="{StaticResource LabelStyleMyScheduleForLabel}"
                                                                                       Text="Rating:"
                                                                                       FontFamily="{DynamicResource SemiBold}"
                                                                                       TextColor="{DynamicResource PrimaryColor}"
                                                                                       HorizontalOptions="Start"
                                                                                       VerticalOptions="Start" />

                                                                                <Label Grid.Column="1"
                                                                                       Style="{StaticResource LabelStyleMySchedule}"
                                                                                       FontFamily="{DynamicResource Medium}"
                                                                                       Text="{Binding EmployeeRating}" />

                                                                                <!--<control:SfTextInputLayout Style="{DynamicResource inputLayoutStyle}"
                                                                                     Hint=""
                                                                                     Grid.Column="1"
                                                                                     Margin="0,0,10,0">
                                                                                     
                                                                                     <numeric:SfNumericTextBox Value="{Binding EmployeeRating, Mode=TwoWay}"
                                                                                     Style="{StaticResource SfNumericTextBoxStyle}" />
                                                                                     </control:SfTextInputLayout>-->
                                                                            </Grid>

                                                                            <StackLayout Margin="0,5" />

                                                                            <BoxView Style="{DynamicResource SeparatorStyle}"
                                                                                     BackgroundColor="{DynamicResource Gray-500}"
                                                                                     Margin="0,5,0,5"
                                                                                     IsVisible="{Binding ShowLine}" />
                                                                        </StackLayout>
                                                                    </border:SfBorder>
                                                                </effects:SfEffectsView>
                                                            </DataTemplate>
                                                        </BindableLayout.ItemTemplate>
                                                    </StackLayout>
                                                </expander:SfExpander.Content>
                                            </expander:SfExpander>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </StackLayout>
                            </expander:SfExpander.Content>
                        </expander:SfExpander>
                    </utils:CustomShadowFrame.Content>
                </utils:CustomShadowFrame>
            </DataTemplate>
        </BindableLayout.ItemTemplate>
    </StackLayout>
</StackLayout>