<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="EatWork.Mobile.Views.PerformanceEvaluation.NarrativeSectionPage"
             xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:busyindicator="clr-namespace:Syncfusion.SfBusyIndicator.XForms;assembly=Syncfusion.SfBusyIndicator.XForms"
             xmlns:button="clr-namespace:Syncfusion.XForms.Buttons;assembly=Syncfusion.Buttons.XForms"
             xmlns:control="clr-namespace:Syncfusion.XForms.TextInputLayout;assembly=Syncfusion.Core.XForms"
             xmlns:effect="clr-namespace:EatWork.Mobile.Utils.Effects"
             xmlns:expander="clr-namespace:Syncfusion.XForms.Expander;assembly=Syncfusion.Expander.XForms"
             xmlns:gradient="clr-namespace:Syncfusion.XForms.Graphics;assembly=Syncfusion.Core.XForms"
             xmlns:iconize="clr-namespace:Plugin.Iconize;assembly=Plugin.Iconize"
             xmlns:self="clr-namespace:EatWork.Mobile.Views.PerformanceEvaluation"
             xmlns:utils="clr-namespace:EatWork.Mobile.Utils"
             Style="{DynamicResource ContentPageNoiOSSafeArea}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <utils:CustomConverter x:Key="EventArgs" />
            <utils:TextToBoolConverter x:Key="TextToBoolConverter" />

            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Style="{StaticResource TitleViewContent}">
        <gradient:SfGradientView Grid.Row="0" Style="{DynamicResource NavBarStyle}" />

        <ContentView>
            <ContentView.Effects>
                <effect:SafeAreaPaddingEffect />
            </ContentView.Effects>
            <utils:TitleView Title="Performance Evaluation" TitleColor="{StaticResource Gray-White}">
                <utils:TitleView.LeadingView>
                    <iconize:IconButton Command="{Binding BackButtonCommand}"
                                        Style="{StaticResource IconButtonStyle}"
                                        Text="{StaticResource BackButtonIcon}" />
                </utils:TitleView.LeadingView>
            </utils:TitleView>
        </ContentView>

        <!--  PAGE CONTENT  -->
        <StackLayout Grid.Row="2"
                     Margin="0,0,0,0"
                     Spacing="0">
            <AbsoluteLayout HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">

                <busyindicator:SfBusyIndicator x:Name="busyindicator"
                                               IsBusy="{Binding IsBusy}"
                                               Style="{StaticResource BusyIndicatorStyle}" />

                <ScrollView Margin="0,16,0,0"
                            Padding="0,0"
                            AbsoluteLayout.LayoutBounds="0,0,1,1"
                            AbsoluteLayout.LayoutFlags="All"
                            HorizontalScrollBarVisibility="Never"
                            IsVisible="{Binding IsBusy, Converter={utils:InverseBoolConverter}}"
                            VerticalOptions="StartAndExpand"
                            VerticalScrollBarVisibility="Never">

                    <Grid ColumnDefinitions="Auto, *"
                          ColumnSpacing="0"
                          RowDefinitions="Auto, Auto, Auto, *, Auto"
                          RowSpacing="0"
                          VerticalOptions="FillAndExpand">

                        <!--  HEADER  -->
                        <self:HeaderTemplate2 Margin="0,0" />

                        <!--  DETAILS  -->
                        <Grid Grid.Row="3"
                              Margin="8,8"
                              RowDefinitions="*"
                              RowSpacing="2">

                            <StackLayout x:Name="Details"
                                         Margin="0,0,0,0"
                                         BindableLayout.ItemsSource="{Binding Holder.Narratives}">

                                <BindableLayout.ItemTemplate>
                                    <DataTemplate>
                                        <utils:CustomShadowFrame Margin="8,0,8,4"
                                                                 Padding="0,0"
                                                                 BackgroundColor="{DynamicResource Transparent}"
                                                                 BorderColor="{DynamicResource Transparent}"
                                                                 CornerRadius="0"
                                                                 HorizontalOptions="FillAndExpand"
                                                                 IsVisible="{Binding IsHidden, Converter={utils:InverseBoolConverter}}"
                                                                 Style="{DynamicResource CustomFrameStyle}"
                                                                 VerticalOptions="FillAndExpand">
                                            <expander:SfExpander HeaderBackgroundColor="{DynamicResource PrimaryColor}"
                                                                 HeaderIconPosition="End"
                                                                 IconColor="{DynamicResource Gray-White}"
                                                                 IsExpanded="{Binding IsOpened}">

                                                <expander:SfExpander.Header>
                                                    <StackLayout Padding="10,12" Spacing="0">

                                                        <Label LineBreakMode="TailTruncation"
                                                               Style="{StaticResource HeaderStyle}"
                                                               Text="{Binding Question}"
                                                               TextType="Html" />
                                                    </StackLayout>
                                                </expander:SfExpander.Header>

                                                <expander:SfExpander.Content>
                                                    <StackLayout Margin="2,0"
                                                                 Padding="0,5"
                                                                 Spacing="5"
                                                                 VerticalOptions="Start">

                                                        <control:SfTextInputLayout EnableFloating="False"
                                                                                   HasError="{Binding HasError}"
                                                                                   Hint="Enter remarks  "
                                                                                   Style="{StaticResource InputLayoutStyleEditor}">

                                                            <Editor IsEnabled="{Binding IsEnabled}"
                                                                    Style="{DynamicResource EditorStyle}"
                                                                    Text="{Binding Answer, Mode=TwoWay}">
                                                                <Editor.Behaviors>
                                                                    <utils:EventToCommandBehavior Command="{Binding Path=BindingContext.UnfocusedCommand, Source={x:Reference Details}}"
                                                                                                  CommandParameter="{Binding .}"
                                                                                                  EventName="Unfocused" />
                                                                </Editor.Behaviors>
                                                            </Editor>
                                                        </control:SfTextInputLayout>
                                                    </StackLayout>
                                                </expander:SfExpander.Content>
                                            </expander:SfExpander>
                                        </utils:CustomShadowFrame>
                                    </DataTemplate>
                                </BindableLayout.ItemTemplate>
                            </StackLayout>
                        </Grid>

                        <StackLayout Grid.Row="4" Margin="0,40" />
                    </Grid>
                </ScrollView>

                <!--  BUTTONS  -->
                <StackLayout x:Name="ScanView"
                             AbsoluteLayout.LayoutBounds="0,1,1,0.10"
                             AbsoluteLayout.LayoutFlags="All"
                             BackgroundColor="{DynamicResource Gray-Bg}"
                             IsVisible="{Binding IsBusy, Converter={utils:InverseBoolConverter}}">

                    <BoxView BackgroundColor="{DynamicResource Gray-300}"
                             HeightRequest="{OnIdiom Default=1,
                                                     Desktop=0}"
                             Style="{StaticResource SeparatorStyle}" />

                    <!--<button:SfButton x:Name="btnBackButton2"
                                     Grid.Column="0"
                                     Margin="10,10"
                                     BackgroundColor="#e4e4e4"
                                     Command="{Binding BackButtonCommand}"
                                     CornerRadius="20"
                                     FontFamily="{DynamicResource SemiBold}"
                                     FontSize="{DynamicResource Small}"
                                     HeightRequest="40"
                                     HorizontalOptions="CenterAndExpand"
                                     IsVisible="{Binding ForSubmission, Converter={utils:InverseBoolConverter}}"
                                     Text="Back"
                                     TextColor="Black"
                                     VerticalOptions="EndAndExpand"
                                     VerticalTextAlignment="Center"
                                     WidthRequest="180" />-->

                    <FlexLayout Margin="0,0"
                                Direction="Row"
                                HorizontalOptions="CenterAndExpand"
                                JustifyContent="{Binding ForSubmission, Converter={utils:FlexLayoutContentConverter}}"
                                VerticalOptions="CenterAndExpand">

                        <button:SfButton x:Name="BackButtonText"
                                         Grid.Column="0"
                                         Margin="10,10"
                                         BackgroundColor="#e4e4e4"
                                         Command="{Binding BackButtonCommand}"
                                         CornerRadius="20"
                                         FontFamily="{DynamicResource SemiBold}"
                                         FontSize="{DynamicResource Small}"
                                         HeightRequest="40"
                                         HorizontalOptions="CenterAndExpand"
                                         Text="Back"
                                         TextColor="Black"
                                         VerticalOptions="EndAndExpand"
                                         VerticalTextAlignment="Center"
                                         WidthRequest="200" />

                        <button:SfButton x:Name="NextButtonText"
                                         Grid.Column="1"
                                         Margin="10,10"
                                         Command="{Binding SaveCommand}"
                                         IsVisible="{Binding CanSave}"
                                         Style="{StaticResource WalkthroughButtonStyle}"
                                         Text="Save" />

                        <button:SfButton x:Name="btnSubmit"
                                         Grid.Column="2"
                                         Margin="10,10"
                                         Command="{Binding SubmitRecordCommand}"
                                         IsEnabled="{Binding ForSubmission}"
                                         IsVisible="{Binding CanSubmit}"
                                         Style="{StaticResource WalkthroughButtonStyle}"
                                         Text="Submit" />
                    </FlexLayout>

                    <!--<Grid Margin="0,0"
                          Padding="0"
                          ColumnDefinitions="*,*,*"
                          HorizontalOptions="CenterAndExpand"
                          IsVisible="{Binding ForSubmission}"
                          VerticalOptions="CenterAndExpand">

                        <button:SfButton x:Name="BackButtonText"
                                         Grid.Column="0"
                                         Margin="10,10"
                                         BackgroundColor="#e4e4e4"
                                         Command="{Binding BackButtonCommand}"
                                         CornerRadius="20"
                                         FontFamily="{DynamicResource SemiBold}"
                                         FontSize="{DynamicResource Small}"
                                         HeightRequest="40"
                                         HorizontalOptions="CenterAndExpand"
                                         Text="Back"
                                         TextColor="Black"
                                         VerticalOptions="EndAndExpand"
                                         VerticalTextAlignment="Center"
                                         WidthRequest="200" />

                        <button:SfButton x:Name="NextButtonText"
                                         Grid.Column="1"
                                         Margin="10,10"
                                         Command="{Binding SaveCommand}"
                                         IsVisible="{Binding CanSave}"
                                         Style="{StaticResource WalkthroughButtonStyle}"
                                         Text="Save" />

                        <button:SfButton x:Name="btnSubmit"
                                         Grid.Column="2"
                                         Margin="10,10"
                                         Command="{Binding SubmitRecordCommand}"
                                         IsEnabled="{Binding ForSubmission}"
                                         IsVisible="{Binding CanSubmit}"
                                         Style="{StaticResource WalkthroughButtonStyle}"
                                         Text="Submit" />
                    </Grid>-->
                </StackLayout>
            </AbsoluteLayout>
        </StackLayout>
    </Grid>
</ContentPage>