<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:utils="clr-namespace:EatWork.Mobile.Utils"
             xmlns:iconize="clr-namespace:Plugin.Iconize;assembly=Plugin.Iconize"
             xmlns:listView="clr-namespace:Syncfusion.ListView.XForms;assembly=Syncfusion.SfListView.XForms"
             xmlns:busyindicator="clr-namespace:Syncfusion.SfBusyIndicator.XForms;assembly=Syncfusion.SfBusyIndicator.XForms"
             xmlns:border="clr-namespace:Syncfusion.XForms.Border;assembly=Syncfusion.Core.XForms"
             xmlns:button="clr-namespace:Syncfusion.XForms.Buttons;assembly=Syncfusion.Buttons.XForms"
             xmlns:cards="clr-namespace:Syncfusion.XForms.Cards;assembly=Syncfusion.Cards.XForms"
             Title="Transaction History"
             mc:Ignorable="d"
             Style="{StaticResource ContentPage}"
             x:Class="EatWork.Mobile.Views.TransactionHistoryPage">

    <ContentPage.Resources>
        <ResourceDictionary>
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <AbsoluteLayout VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand">

            <busyindicator:SfBusyIndicator x:Name="busyindicator"
                                           Style="{StaticResource BusyIndicatorStyle}"
                                           IsBusy="{Binding IsBusy}" />

            <Grid RowSpacing="0" ColumnSpacing="0"
                  AbsoluteLayout.LayoutFlags="All"
                  AbsoluteLayout.LayoutBounds="0,0,1,1"
                  IsVisible="{Binding IsBusy,Converter={utils:InverseBoolConverter}}">
                <Grid.RowDefinitions>
                    <!--<RowDefinition Height="Auto" />
                         <RowDefinition Height="Auto" />-->
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <StackLayout Grid.Row="0" Margin="10,10" Spacing="0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="80" />
                        </Grid.ColumnDefinitions>

                        <Label Text="Transaction History" HorizontalOptions="Start"
                               FontSize="20"
                               FontFamily="{DynamicResource Bold}"
                               TextColor="{DynamicResource Gray-900}"
                               Grid.Column="0" />

                        <button:SfButton x:Name="SkipButton"
                                         Grid.Column="1"
                                         BackgroundColor="Transparent"
                                         Command="{Binding CloseModalCommand}"
                                         CornerRadius="20"
                                         FontFamily="{DynamicResource SemiBold}"
                                         HeightRequest="40"
                                         HorizontalOptions="End"
                                         Text="Close"
                                         TextColor="{x:StaticResource HyperLink}"
                                         VerticalOptions="StartAndExpand"
                                         WidthRequest="80" />
                    </Grid>

                    <Grid RowSpacing="0" ColumnSpacing="0" Margin="0,20,0,0">

                        <!--BackgroundColor="{DynamicResource Gray-400}"-->
                        <BoxView HeightRequest="{Binding Source={x:Reference listView}, Path=Height}"
                                 HorizontalOptions="Start"
                                 VerticalOptions="Start"
                                 WidthRequest="1"
                                 Margin="18,0,0,0"
                                 BackgroundColor="{OnPlatform Android={StaticResource Gray-400}, iOS={StaticResource Gray-800}}" />

                        <listView:SfListView VerticalOptions="Start"
                                             x:Name="listView"
                                             ItemsSource="{Binding TransactionHistory}"
                                             AutoFitMode="Height"
                                             SelectionMode="None"
                                             SelectionBackgroundColor="Transparent"
                                             AllowSwiping="True"
                                             ItemSpacing="0,0,0,20"
                                             IsScrollBarVisible="False">

                            <listView:SfListView.ItemTemplate>
                                <DataTemplate>
                                    <ViewCell>
                                        <Grid ColumnSpacing="0" RowSpacing="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <!--<Grid.RowDefinitions>
                                                 <RowDefinition Height="Auto" />
                                                 <RowDefinition Height="*" />
                                                 </Grid.RowDefinitions>-->

                                            <!--<Label Text="{Binding LogDate,Converter={utils:WFTransactionHistoryDateConverter}}"
                                                 LineHeight="{OnPlatform Default=1.25, iOS=-1}"
                                                 Margin="0,10,0,0"
                                                 FontFamily="{DynamicResource Medium}"
                                                 WidthRequest="80"
                                                 FontSize="14"
                                                 TextColor="{DynamicResource Gray-700}"
                                                 HorizontalOptions="Start" />-->

                                            <Label x:Name="ActionTypeId" Text="{Binding ActionTypeId}" IsVisible="False" />

                                            <border:SfBorder BackgroundColor="{Binding HistoryTypeId,Converter={utils:HistoryTypeToColorConverter},ConverterParameter={x:Reference ActionTypeId}}"
                                                             Grid.Column="1"
                                                             HorizontalOptions="Center"
                                                             VerticalOptions="Start"
                                                             WidthRequest="40"
                                                             HeightRequest="40"
                                                             BorderColor="Transparent"
                                                             CornerRadius="20"
                                                             Margin="0,0,0,0">

                                                <border:SfBorder WidthRequest="32"
                                                                 HeightRequest="32"
                                                                 BorderColor="Transparent"
                                                                 BackgroundColor="{Binding HistoryTypeId,Converter={utils:HistoryTypeToColorConverter},ConverterParameter={x:Reference ActionTypeId}}"
                                                                 HorizontalOptions="Center"
                                                                 VerticalOptions="Center"
                                                                 CornerRadius="20"
                                                                 Margin="4"
                                                                 BorderWidth="1.5">

                                                    <iconize:IconLabel TextColor="{DynamicResource Gray-White}"
                                                                       FontSize="18"
                                                                       HorizontalOptions="Center"
                                                                       VerticalOptions="Center"
                                                                       Text="{Binding HistoryTypeId,Converter={utils:HistoryTypeToIconConverter},ConverterParameter={x:Reference ActionTypeId}}" />

                                                    <!--<Label Text="{Binding Icon}"
                                                         TextColor="{DynamicResource Gray-White}"
                                                         FontSize="18"
                                                         FontFamily="{StaticResource FontIcons}"
                                                         HorizontalOptions="Center"
                                                         VerticalOptions="Center" />-->
                                                </border:SfBorder>
                                            </border:SfBorder>

                                            <StackLayout Spacing="2" Grid.Column="2" HorizontalOptions="StartAndExpand" VerticalOptions="StartAndExpand" Margin="10,0,0,0">
                                                <cards:SfCardView BackgroundColor="#F2F6F9"  CornerRadius="4" IndicatorColor="#DAE1E5" IndicatorPosition="Left" IndicatorThickness="3" Grid.Row="0">
                                                    <!--<StackLayout Padding="5,10" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">-->
                                                    <Grid Padding="5,10" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">

                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" />
                                                        </Grid.RowDefinitions>

                                                        <Label Text="{Binding MessageTemplate}"
                                                               FontSize="13"
                                                               LineHeight="{OnPlatform Default=1.25, iOS=-1}"
                                                               FontFamily="{DynamicResource Medium}"
                                                               TextColor="{DynamicResource Gray-700}"
                                                               TextType="Html"
                                                               Grid.Row="0" />

                                                        <Grid Margin="0,10,0,0" IsVisible="{Binding LogDate,Converter={utils:DateTimeToBoolConverter}}" Grid.Row="1">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="8*" />
                                                                <ColumnDefinition Width="93*" />
                                                            </Grid.ColumnDefinitions>

                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>

                                                            <iconize:IconLabel Text="{StaticResource TimeIcon}"
                                                                               Style="{StaticResource IconizeIconStyle}"
                                                                               FontSize="20"
                                                                               Grid.Column="0"
                                                                               LineHeight="{OnPlatform Default=1.25, iOS=-1}" />

                                                            <Label LineHeight="{OnPlatform Default=1.25, iOS=-1}"
                                                                   FontFamily="{DynamicResource Medium}"
                                                                   FontSize="14"
                                                                   Grid.Column="1"
                                                                   TextColor="{DynamicResource Gray-700}"
                                                                   HorizontalOptions="Start"
                                                                   Text="{Binding LogDate,Converter={utils:WFTransactionHistoryDateConverter}}" />
                                                        </Grid>
                                                    </Grid>
                                                    <!--</StackLayout>-->
                                                </cards:SfCardView>
                                            </StackLayout>
                                        </Grid>
                                    </ViewCell>
                                </DataTemplate>
                            </listView:SfListView.ItemTemplate>
                        </listView:SfListView>
                    </Grid>
                </StackLayout>
            </Grid>
        </AbsoluteLayout>
    </ContentPage.Content>
</ContentPage>