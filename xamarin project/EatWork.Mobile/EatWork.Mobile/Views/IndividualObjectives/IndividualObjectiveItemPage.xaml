<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:utils="clr-namespace:EatWork.Mobile.Utils"
             xmlns:effect="clr-namespace:EatWork.Mobile.Utils.Effects"
             xmlns:template="clr-namespace:EatWork.Mobile.Views.Template"
             xmlns:ffsvg="clr-namespace:FFImageLoading.Svg.Forms;assembly=FFImageLoading.Svg.Forms"
             xmlns:iconize="clr-namespace:Plugin.Iconize;assembly=Plugin.Iconize"
             xmlns:busyindicator="clr-namespace:Syncfusion.SfBusyIndicator.XForms;assembly=Syncfusion.SfBusyIndicator.XForms"
             xmlns:buttons="clr-namespace:Syncfusion.XForms.Buttons;assembly=Syncfusion.Buttons.XForms"
             xmlns:core="clr-namespace:Syncfusion.XForms.Core;assembly=Syncfusion.Core.XForms"
             xmlns:gradient="clr-namespace:Syncfusion.XForms.Graphics;assembly=Syncfusion.Core.XForms"
             xmlns:maskededit="clr-namespace:Syncfusion.XForms.MaskedEdit;assembly=Syncfusion.SfMaskedEdit.XForms"
             xmlns:control="clr-namespace:Syncfusion.XForms.TextInputLayout;assembly=Syncfusion.Core.XForms"
             x:Class="EatWork.Mobile.Views.IndividualObjectives.IndividualObjectiveItemPage"
             Style="{DynamicResource ContentPageNoiOSSafeArea}">

    <ContentPage.Behaviors>
        <utils:EventToCommandBehavior Command="{Binding PageAppearingCommand}"
                                      EventName="Appearing" />
        <utils:EventToCommandBehavior Command="{Binding PageDisappearingCommand}"
                                      EventName="Disappearing" />
    </ContentPage.Behaviors>

    <ContentPage.Resources>
        <ResourceDictionary>
            <utils:CustomConverter x:Key="EventArgs" />
            <utils:TextToBoolConverter x:Key="TextToBoolConverter" />
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Requests/Styles.xaml" />
                <ResourceDictionary Source="../Template/Styles.xaml" />
                <ResourceDictionary Source="../Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>

        <Style x:Key="HeaderStyle" BasedOn="{StaticResource PriceLabelStyle}" TargetType="Label">
            <Setter Property="FontSize" Value="{DynamicResource Small}" />
            <Setter Property="FontFamily" Value="{DynamicResource SemiBold}" />
            <Setter Property="LineHeight" Value="{OnPlatform Android=1.25, Default=-1}" />
            <Setter Property="TextColor" Value="{DynamicResource Gray-White}" />
            <Setter Property="Margin" Value="0,0" />
        </Style>
        <buttons:SfRadioGroupKey x:Key="PeriodType" />
    </ContentPage.Resources>

    <Grid Style="{StaticResource TitleViewContent}">
        <gradient:SfGradientView Grid.Row="0"
                                 Style="{DynamicResource NavBarStyle}" />

        <ContentView>
            <ContentView.Effects>
                <effect:SafeAreaPaddingEffect />
            </ContentView.Effects>
            <utils:TitleView Title="Individual Objective"
                             TitleColor="{StaticResource Gray-White}">
                <utils:TitleView.LeadingView>
                    <iconize:IconButton Text="{StaticResource BackButtonIcon}"
                                        Command="{Binding BackButtonCommand}"
                                        Style="{StaticResource IconButtonStyle}" />
                </utils:TitleView.LeadingView>
            </utils:TitleView>
        </ContentView>

        <StackLayout Grid.Row="2"
                     Spacing="0">
            <AbsoluteLayout VerticalOptions="FillAndExpand"
                            HorizontalOptions="FillAndExpand">

                <busyindicator:SfBusyIndicator x:Name="busyindicator"
                                               Style="{StaticResource BusyIndicatorStyle}"
                                               IsBusy="{Binding IsBusy}" />

                <StackLayout AbsoluteLayout.LayoutBounds="0,0,1,1"
                             AbsoluteLayout.LayoutFlags="All"
                             VerticalOptions="FillAndExpand"
                             Padding="15,0"
                             Margin="0,10"
                             Spacing="10"
                             IsVisible="{Binding IsBusy,Converter={utils:InverseBoolConverter}}">
                    <ScrollView HorizontalScrollBarVisibility="Never"
                                VerticalScrollBarVisibility="Never">

                        <Grid Padding="0,0"
                              RowSpacing="0"
                              ColumnSpacing="0"
                              HorizontalOptions="CenterAndExpand"
                              VerticalOptions="CenterAndExpand">

                            <utils:CustomShadowFrame Padding="0,0,0,0"
                                                     HorizontalOptions="FillAndExpand"
                                                     Style="{StaticResource CustomFrameStyle}">

                                <StackLayout Style="{StaticResource StackLayoutRequestForm}">

                                    <Grid IsEnabled="{Binding FormHelper.IsEnabled}"
                                          RowDefinitions="*"
                                          ColumnDefinitions="*"
                                          Padding="0,0">

                                        <StackLayout Grid.Row="0"
                                                     Grid.Column="0">
                                            <control:SfTextInputLayout Style="{StaticResource InputLayoutStyleWithIcon}"
                                                                       HasError="{Binding FormHelper.PreparedDate.IsValid,Converter={utils:InverseBoolConverter}}"
                                                                       Hint="Prepared Date  ">

                                                <DatePicker x:Name="PreparedDate"
                                                            IsEnabled="{Binding FormHelper.IsEnabled}"
                                                            Style="{StaticResource DatePickerStyle}"
                                                            Date="{Binding FormHelper.PreparedDate, Mode=TwoWay}" />

                                                <control:SfTextInputLayout.LeadingView>
                                                    <iconize:IconLabel Text="{StaticResource DateIcon}"
                                                                       Style="{StaticResource IconizeIconStyle}" />
                                                </control:SfTextInputLayout.LeadingView>
                                            </control:SfTextInputLayout>
                                        </StackLayout>

                                        <StackLayout Grid.Row="0"
                                                     Grid.Column="1"
                                                     Padding="0,0,0,0">
                                            <control:SfTextInputLayout Style="{StaticResource InputLayoutStyleWithIcon}"
                                                                       HasError="{Binding FormHelper.EffectiveYear.IsValid,Converter={utils:InverseBoolConverter}}"
                                                                       Hint="Effective Year  ">

                                                <maskededit:SfMaskedEdit Keyboard="Numeric"
                                                                         Mask="0000"
                                                                         Value="{Binding FormHelper.EffectiveYear.Value, Mode=TwoWay}"
                                                                         IsEnabled="{Binding FormHelper.IsEnabled}"
                                                                         Style="{DynamicResource MaskedEditStyle}" />

                                                <control:SfTextInputLayout.LeadingView>
                                                    <iconize:IconLabel Text="{StaticResource DateIcon}"
                                                                       Style="{StaticResource IconizeIconStyle}" />
                                                </control:SfTextInputLayout.LeadingView>
                                            </control:SfTextInputLayout>
                                        </StackLayout>
                                    </Grid>

                                    <!--<BoxView Style="{DynamicResource SeparatorStyle}" />-->

                                    <!--OBJECTIVES LIST-->
                                    <StackLayout Margin="0,5,0,0"
                                                 Orientation="Horizontal">

                                        <StackLayout Margin="0,0"
                                                     Orientation="Horizontal"
                                                     HorizontalOptions="StartAndExpand">
                                            <Label FontFamily="{DynamicResource Bold}"
                                                   FontSize="{StaticResource Smaller}"
                                                   Text="Objectives"
                                                   VerticalOptions="Center"
                                                   TextColor="{DynamicResource Gray-800}" />
                                            <!--<iconize:IconImage Margin="10,0,0,0"
                                                 WidthRequest="20"
                                                 HeightRequest="20"
                                                 Icon="{DynamicResource AddIcon}"
                                                 IconColor="{DynamicResource PrimaryColor}">
                                                 <iconize:IconImage.GestureRecognizers>
                                                 <TapGestureRecognizer Command="{Binding AddObjectiveCommand}" />
                                                 </iconize:IconImage.GestureRecognizers>
                                                 </iconize:IconImage>-->
                                        </StackLayout>

                                        <buttons:SfButton x:Name="ShowButton"
                                                          Padding="0"
                                                          Command="{Binding ViewAllObjectivesCommand}"
                                                          FontSize="{OnIdiom Default=12,Desktop=14}"
                                                          HorizontalOptions="End"
                                                          Style="{DynamicResource TransparentButtonStyle}"
                                                          Text="VIEW ALL"
                                                          VerticalOptions="Center"
                                                          IsVisible="{Binding FormHelper.IsExceeded}" />
                                    </StackLayout>

                                    <StackLayout BackgroundColor="Transparent"
                                                 Spacing="0"
                                                 VerticalOptions="Center"
                                                 Padding="20,20"
                                                 IsVisible="{Binding FormHelper.Objectives, Converter={utils:ListToBoolConverter}}">
                                        <!--  Image for display svg image  -->
                                        <ffsvg:SvgCachedImage x:Name="ErrorImage"
                                                              Margin="{x:OnIdiom Phone='0,0,0,0', Desktop='0',Tablet='0'}"
                                                              BackgroundColor="Transparent"
                                                              HeightRequest="{core:OnPlatformOrientationDoubleValue Default=300,
                                                              AndroidPhonePortrait=280,
                                                              AndroidPhoneLandscape=200,
                                                              iOSPhonePortrait=280,
                                                              iOSPhoneLandscape=200}"
                                                              Source="NoItems.svg"
                                                              VerticalOptions="Center"
                                                              HorizontalOptions="Center"
                                                              WidthRequest="{x:OnIdiom Phone=280, Desktop=300, Tablet=300}"
                                                              FadeAnimationEnabled="False" />

                                        <Label Margin="8,8,8,0"
                                               FontFamily="{DynamicResource Medium}"
                                               FontSize="16"
                                               Style="{StaticResource LabelStyle}"
                                               TextColor="{DynamicResource Gray-900}"
                                               VerticalTextAlignment="Center"
                                               VerticalOptions="Center"
                                               HorizontalOptions="Center"
                                               x:Name="ContentText"
                                               Text="No objectives found. Click + icon to add." />
                                    </StackLayout>

                                    <StackLayout Margin="0,0"
                                                 IsVisible="{Binding FormHelper.Objectives,Converter={utils:ListToInverseBoolConverter}}">
                                        <ScrollView HorizontalScrollBarVisibility="Never" VerticalScrollBarVisibility="Never">
                                            <StackLayout Margin="0,0,0,0"
                                                         BindableLayout.ItemsSource="{Binding FormHelper.ObjectivesLimited}"
                                                         x:Name="Details">
                                                <BindableLayout.ItemTemplate>
                                                    <DataTemplate>
                                                        <template:ObjectiveListTemplate />
                                                    </DataTemplate>
                                                </BindableLayout.ItemTemplate>
                                            </StackLayout>
                                        </ScrollView>

                                        <!--<buttons:SfButton x:Name="ShowButton"
                                             Padding="0"
                                             Command="{Binding ViewAllObjectivesCommand}"
                                             FontSize="{OnIdiom Default=12,Desktop=14}"
                                             HorizontalOptions="Center"
                                             Style="{DynamicResource TransparentButtonStyle}"
                                             Text="VIEW ALL"
                                             VerticalOptions="Center"
                                             IsVisible="{Binding FormHelper.IsExceeded}" />-->
                                    </StackLayout>
                                </StackLayout>
                            </utils:CustomShadowFrame>
                        </Grid>
                    </ScrollView>

                    <!--TO DISPLAY BOTTOM ITEM ON LIST IF MULTIPLE MODE-->
                    <StackLayout Margin="0,40" IsVisible="{Binding FormHelper.IsEditable}"/>
                </StackLayout>

                <!--BUTTONS-->
                <StackLayout x:Name="ScanView"
                             AbsoluteLayout.LayoutBounds="0,1,1,0.14"
                             AbsoluteLayout.LayoutFlags="All"
                             BackgroundColor="{DynamicResource Gray-Bg}"
                             IsVisible="{Binding FormHelper.ShowButton}">

                    <BoxView HeightRequest="{OnIdiom Default=1, Desktop=0}"
                             Style="{StaticResource SeparatorStyle}"
                             BackgroundColor="{DynamicResource Gray-300}" />

                    <StackLayout Margin="0,5,0,5"
                                 VerticalOptions="End"
                                 Padding="{OnIdiom Default='0, 0, 0, 0', Phone=0}"
                                 BackgroundColor="{DynamicResource Transparent}">

                        <FlexLayout Direction="Row"
                                    VerticalOptions="End"
                                    Margin="0,0,0,0"
                                    JustifyContent="SpaceEvenly">

                            <buttons:SfButton x:Name="btnSave"
                                              HorizontalOptions="End"
                                              IsVisible="{Binding FormHelper.IsEditable}"
                                              BackgroundColor="{StaticResource Transparent}"
                                              Command="{Binding SaveCommand}">
                                <buttons:SfButton.Content>
                                    <Grid Margin="0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="54" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <iconize:IconButton Text="{StaticResource SaveIcon}"
                                                            Style="{StaticResource BtnRequestStyle}" />
                                        <Label Text="Save"
                                               Style="{StaticResource FooterButtonLabelStyle}" />
                                    </Grid>
                                </buttons:SfButton.Content>
                            </buttons:SfButton>

                            <buttons:SfButton x:Name="btnSubmit"
                                              HorizontalOptions="End"
                                              IsVisible="{Binding FormHelper.IsEditable}"
                                              BackgroundColor="{StaticResource Transparent}"
                                              Command="{Binding SubmitCommand}">
                                <buttons:SfButton.Content>
                                    <Grid Margin="0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="54" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <iconize:IconButton Text="{StaticResource SubmitIcon}"
                                                            Style="{StaticResource BtnRequestStyle}" />
                                        <Label Text="Submit"
                                               Style="{StaticResource FooterButtonLabelStyle}" />
                                    </Grid>
                                </buttons:SfButton.Content>
                            </buttons:SfButton>

                            <buttons:SfButton Style="{StaticResource btnLoginStyle}"
                                              Command="{Binding CancelCommand}"
                                              Text="Cancel"
                                              IsVisible="{Binding FormHelper.ShowCancelButton}"
                                              WidthRequest="245"
                                              HeightRequest="40"
                                              HorizontalOptions="End"
                                              Margin="0,20,0,10" />
                        </FlexLayout>
                    </StackLayout>
                </StackLayout>

                <!--FAB-->
                <iconize:IconButton Style="{DynamicResource FABStyle}"
                                    Command="{Binding AddObjectiveCommand}"
                                    IsVisible="{Binding FormHelper.IsEditable}"
                                    AbsoluteLayout.LayoutBounds=".95 ,.80, AutoSize, AutoSize" />
            </AbsoluteLayout>
        </StackLayout>
    </Grid>
</ContentPage>