@using System.Text

<div class="mini-chart" style="height: @(Height)px;">
    <svg viewBox="0 0 100 100" preserveAspectRatio="none" style="width: 100%; height: 100%;">
        @if (Data != null && Data.Any())
        {
            <!-- Line -->
            <path d="@GeneratePath()" 
                  fill="none" 
                  stroke="@Color" 
                  stroke-width="3" 
                  stroke-linecap="round" 
                  stroke-linejoin="round" />
                  
            @if (IsArea)
            {
                <!-- Area Fill (Optional) -->
                <path d="@GenerateAreaPath()" 
                      fill="@Color" 
                      fill-opacity="0.2" 
                      stroke="none" />
            }
        }
    </svg>
</div>

@code {
    [Parameter] public List<double>? Data { get; set; }
    [Parameter] public string Color { get; set; } = "#ffffff";
    [Parameter] public int Height { get; set; } = 40;
    [Parameter] public bool IsArea { get; set; } = false;

    private string GeneratePath()
    {
        if (Data == null || Data.Count < 2) return "";

        var sb = new StringBuilder();
        double min = Data.Min();
        double max = Data.Max();
        double range = max - min;
        
        if (range == 0) range = 1; // Avoid divide by zero

        double stepX = 100.0 / (Data.Count - 1);

        for (int i = 0; i < Data.Count; i++)
        {
            double x = i * stepX;
            // Normalize Y: 100 is bottom, 0 is top. 
            // Value -> (Value - Min) / Range -> 0..1
            // 0..1 -> scale to 0..100 (but flipped)
            double normalizedVal = (Data[i] - min) / range;
            double y = 100 - (normalizedVal * 80 + 10); // Leave 10% padding top/bottom

            sb.Append(i == 0 ? "M" : "L");
            sb.Append($"{x:F1},{y:F1} ");
        }

        return sb.ToString();
    }
    
    private string GenerateAreaPath()
    {
        var linePath = GeneratePath();
        if (string.IsNullOrEmpty(linePath)) return "";
        
        return $"{linePath} L 100,100 L 0,100 Z";
    }
}
