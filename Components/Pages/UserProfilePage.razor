@page "/profile"
@using MauiHybridApp.ViewModels
@inject ProfileViewModel ViewModel
@using MauiHybridApp.Services.Navigation
@inject INavigationService NavigationService

<div class="page-container p-0">
    <div class="animate-fade-in-up">
        <!-- Premium Header -->
        <div class="profile-header text-white text-center position-relative mb-5" 
             style="background: linear-gradient(135deg, #1e3c72, #2a5298); border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; padding-top: 2rem; padding-bottom: 3.5rem;">
            
            <div class="d-flex justify-content-between align-items-center px-4 mb-3">
                <button class="btn btn-link text-white p-0" @onclick="@(() => ViewModel.GoBackCommand.Execute(null))">
                    <i class="fas fa-arrow-left fa-lg"></i>
                </button>
                <h5 class="mb-0 fw-bold letter-spacing-1">My Profile</h5>
                <div style="width: 24px;"></div> <!-- Spacer -->
            </div>

            <div class="position-absolute start-50 translate-middle-x" style="bottom: -50px;">
                <div class="position-relative d-inline-block">
                    <div class="profile-photo-container rounded-circle shadow-lg border-4 border-white bg-white overflow-hidden" style="width: 100px; height: 100px;">
                         @if (!string.IsNullOrEmpty(ViewModel.UserProfile?.ProfilePhotoUrl))
                        {
                            <img src="@ViewModel.UserProfile.ProfilePhotoUrl" alt="Profile Photo" class="w-100 h-100 object-fit-cover" />
                        }
                        else
                        {
                            <div class="w-100 h-100 d-flex align-items-center justify-content-center bg-light text-secondary">
                                <i class="fas fa-user fa-3x"></i>
                            </div>
                        }
                    </div>
                    <button class="btn btn-primary rounded-circle shadow-sm position-absolute bottom-0 end-0 d-flex align-items-center justify-content-center" 
                            style="width: 32px; height: 32px; border: 2px solid white;"
                            @onclick="@(() => ViewModel.ChangePhotoCommand.Execute(null))">
                        <i class="fas fa-camera fa-xs"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="px-4 pb-4" style="margin-top: 3.5rem;">
             @if (ViewModel.IsBusy)
            {
                 <LoadingIndicator Message="@ViewModel.BusyText" />
            }
            else if (ViewModel.UserProfile != null)
            {
                <div class="text-center mb-4">
                    <h4 class="fw-bold text-dark mb-1">@ViewModel.UserProfile.FullName</h4>
                    <p class="text-muted small mb-0">@ViewModel.UserProfile.JobTitle</p>
                    <div class="badge bg-light text-primary rounded-pill px-3 py-1 mt-2">@ViewModel.UserProfile.EmployeeId</div>
                </div>

                <!-- Menu Grid -->
                <div class="row g-3">
                    <!-- Personal Details -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/personal-details")'>
                            <div class="mx-auto mb-2 icon-circle bg-primary-subtle text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-user fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Personal</h6>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/contact-information")'>
                            <div class="mx-auto mb-2 icon-circle bg-success-subtle text-success rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-address-book fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Contact</h6>
                        </div>
                    </div>

                    <!-- Family -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/family-background")'>
                            <div class="mx-auto mb-2 icon-circle bg-info-subtle text-info rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-users fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Family</h6>
                        </div>
                    </div>

                    <!-- Emergency -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/emergency-contact")'>
                            <div class="mx-auto mb-2 icon-circle bg-danger-subtle text-danger rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-phone-alt fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Emergency</h6>
                        </div>
                    </div>

                    <!-- Job Info -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/current-job")'>
                            <div class="mx-auto mb-2 icon-circle bg-warning-subtle text-warning rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-briefcase fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Job Info</h6>
                        </div>
                    </div>

                    <!-- Assignment -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/area-of-assignment")'>
                            <div class="mx-auto mb-2 icon-circle bg-info-subtle text-info rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-map-marker-alt fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Location</h6>
                        </div>
                    </div>

                    <!-- Dates -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/relevant-dates")'>
                            <div class="mx-auto mb-2 icon-circle bg-warning-subtle text-warning rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-calendar-alt fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Dates</h6>
                        </div>
                    </div>

                    <!-- Tax Info -->
                    <div class="col-6">
                        <div class="card border-0 shadow-sm h-100 hover-lift text-center py-3" @onclick='() => NavigationService.NavigateToAsync("/profile/tax-info")'>
                            <div class="mx-auto mb-2 icon-circle bg-secondary-subtle text-secondary rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-file-invoice fs-4"></i>
                            </div>
                            <h6 class="small fw-bold text-dark mb-0">Tax Info</h6>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>



@code {
    protected override async Task OnInitializedAsync()
    {
        ViewModel.PropertyChanged += OnViewModelPropertyChanged;
        await ViewModel.InitializeAsync();
    }

    private void OnViewModelPropertyChanged(object? sender, System.ComponentModel.PropertyChangedEventArgs e)
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        if (ViewModel != null)
        {
            ViewModel.PropertyChanged -= OnViewModelPropertyChanged;
        }
    }
}
