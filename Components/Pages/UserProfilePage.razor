@page "/profile"
@using MauiHybridApp.ViewModels
@inject ProfileViewModel ViewModel
@using MauiHybridApp.Services.Navigation
@inject INavigationService NavigationService

<div class="page-container p-0">
    <div class="animate-fade-in-up">
        
        <!-- Standard Header -->
        <div class="px-4 pt-3">
             <PageHeader Title="My Profile" ShowBackButton="true" OnBackClick="@(() => ViewModel.GoBackCommand.Execute(null))" />
        </div>

        <!-- Profile Hero Section -->
        <div class="d-flex flex-column align-items-center mb-4 mt-2">
            <div class="position-relative">
                <div class="profile-photo-container rounded-circle shadow-lg border-4 border-white bg-white overflow-hidden d-flex justify-content-center align-items-center" style="width: 120px; height: 120px;">
                     @if (!string.IsNullOrEmpty(ViewModel.UserProfile?.ProfilePhotoUrl))
                    {
                        <img src="@ViewModel.UserProfile.ProfilePhotoUrl" alt="Profile Photo" class="w-100 h-100 object-fit-cover" />
                    }
                    else
                    {
                         <div class="w-100 h-100 d-flex align-items-center justify-content-center bg-light text-secondary">
                            <i class="fas fa-user fa-4x text-muted"></i>
                        </div>
                    }
                </div>
                <!-- Camera Button -->
                <button class="btn btn-primary rounded-circle shadow-sm position-absolute bottom-0 end-0 d-flex align-items-center justify-content-center" 
                        style="width: 38px; height: 38px; border: 3px solid white;"
                        @onclick="@(() => ViewModel.ChangePhotoCommand.Execute(null))">
                    <i class="fas fa-camera fa-sm"></i>
                </button>
            </div>

            <!-- User Info -->
            <div class="text-center mt-3">
                 @if (ViewModel.IsBusy)
                {
                     <div class="spinner-border text-primary" role="status"></div>
                }
                else if (ViewModel.UserProfile != null)
                {
                    <h3 class="fw-bold text-dark mb-1">@ViewModel.UserProfile.FullName</h3>
                    <p class="text-muted mb-2">@(string.IsNullOrEmpty(ViewModel.UserProfile.JobTitle) ? "Position Not Set" : ViewModel.UserProfile.JobTitle)</p>
                    <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2">ID: @ViewModel.UserProfile.EmployeeId</span>
                }
            </div>
        </div>

        <!-- Menu Grid -->
        <div class="px-4 pb-5">
            <div class="row g-3">
                
                <!-- Personal Details -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/personal-details")'>
                        <div class="mx-auto mb-3 icon-circle bg-primary-subtle text-primary rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-user fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Personal</h6>
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/contact-information")'>
                        <div class="mx-auto mb-3 icon-circle bg-success-subtle text-success rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-address-book fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Contact</h6>
                    </div>
                </div>

                <!-- Family -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/family-background")'>
                        <div class="mx-auto mb-3 icon-circle bg-info-subtle text-info rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-users fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Family</h6>
                    </div>
                </div>

                <!-- Emergency -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/emergency-contact")'>
                        <div class="mx-auto mb-3 icon-circle bg-danger-subtle text-danger rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-phone-alt fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Emergency</h6>
                    </div>
                </div>

                <!-- Job Info -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/current-job")'>
                        <div class="mx-auto mb-3 icon-circle bg-warning-subtle text-warning rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-briefcase fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Job Info</h6>
                    </div>
                </div>

                <!-- Assignment -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/area-of-assignment")'>
                        <div class="mx-auto mb-3 icon-circle bg-info-subtle text-info rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-map-marker-alt fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Location</h6>
                    </div>
                </div>

                <!-- Dates -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/relevant-dates")'>
                        <div class="mx-auto mb-3 icon-circle bg-warning-subtle text-warning rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-calendar-alt fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Dates</h6>
                    </div>
                </div>

                <!-- Tax Info -->
                <div class="col-6">
                    <div class="card glass-panel border-0 h-100 hover-scale text-center py-4" @onclick='() => NavigationService.NavigateToAsync("/profile/tax-info")'>
                        <div class="mx-auto mb-3 icon-circle bg-success-subtle text-success rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 56px; height: 56px;">
                            <i class="fas fa-file-invoice-dollar fs-4"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-0">Tax Info</h6>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>



@code {
    protected override async Task OnInitializedAsync()
    {
        ViewModel.PropertyChanged += OnViewModelPropertyChanged;
        await ViewModel.InitializeAsync();
    }

    private void OnViewModelPropertyChanged(object? sender, System.ComponentModel.PropertyChangedEventArgs e)
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        if (ViewModel != null)
        {
            ViewModel.PropertyChanged -= OnViewModelPropertyChanged;
        }
    }
}
