@page "/employee-list"
@using MauiHybridApp.ViewModels
@using MauiHybridApp.Services.Navigation
@inject EmployeeListViewModel ViewModel
@inject INavigationService NavigationService

<div class="page-container p-0 bg-light-subtle h-100">
    <div class="animate-fade-in-up h-100 d-flex flex-column">
        <!-- Header -->
        <!-- Standard Page Header -->
        <div class="bg-white px-3 pt-3">
            <PageHeader 
                Title="Employee Directory" 
                ShowBackButton="true" 
                OnBackClick="@(() => ViewModel.CloseCommand.Execute(null))" />
            
            <!-- Search Bar (kept separate for layout) -->
            <div class="pb-3">
                 <div class="position-relative">
                    <span class="position-absolute top-50 start-0 translate-middle-y ms-3 text-muted">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" 
                           class="form-control bg-light border-0 rounded-pill ps-5 shadow-sm" 
                           placeholder="Search employees..." 
                           @bind="ViewModel.Keyword"
                           @bind:event="oninput"
                           @onkeyup="@(e => { if (e.Key == "Enter") ViewModel.SearchCommand.Execute(null); })" />
                </div>
            </div>
        </div>

        <!-- Employee List -->
        <div class="flex-grow-1 overflow-auto p-3">
            @if (ViewModel.IsBusy && ViewModel.Employees.Count == 0)
            {
                <div class="text-center py-5 mt-5">
                    <p class="mt-2 text-muted small">Loading directory...</p>
                </div>
            }
            else if (ViewModel.Employees.Count == 0)
            {
                <div class="text-center py-5 mt-5 text-muted">
                    <i class="fas fa-users-slash fa-3x mb-3 text-secondary opacity-50"></i>
                    <p>No employees found.</p>
                </div>
            }
            else
            {
                <div class="row g-3">
                    @foreach (var emp in ViewModel.Employees)
                    {
                        <div class="col-12" @onclick="@(() => ViewModel.SelectEmployeeCommand.Execute(emp))">
                            <div class="card border-0 shadow-sm rounded-4 hover-lift cursor-pointer h-100">
                                <div class="card-body d-flex align-items-center p-3">
                                    <!-- Avatar -->
                                    <div class="flex-shrink-0">
                                        @if (!string.IsNullOrEmpty(emp.ImageSource))
                                        {
                                            <img src="@emp.ImageSource" class="rounded-circle border border-2 border-white shadow-sm object-fit-cover" width="60" height="60" alt="@emp.EmployeeName" />
                                        }
                                        else
                                        {
                                            <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center fw-bold fs-4 border border-2 border-white shadow-sm" style="width: 60px; height: 60px;">
                                                @emp.EmployeeName.Substring(0, 1)
                                            </div>
                                        }
                                    </div>
                                    
                                    <!-- Info -->
                                    <div class="flex-grow-1 ms-3 overflow-hidden">
                                        <h6 class="mb-1 fw-bold text-truncate text-dark">@emp.EmployeeName</h6>
                                        <div class="d-flex align-items-center text-muted small mb-1">
                                            <i class="fas fa-briefcase me-2 text-primary opacity-50" style="width: 16px;"></i>
                                            <span class="text-truncate">@emp.Position</span>
                                        </div>
                                         <div class="d-flex align-items-center text-muted small">
                                            <i class="fas fa-building me-2 text-success opacity-50" style="width: 16px;"></i>
                                            <span class="text-truncate">@emp.Department</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Arrow -->
                                    <div class="ms-2 text-muted opacity-25">
                                        <i class="fas fa-chevron-right"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                
                <!-- Load More Button -->
                <div class="text-center py-4">
                     @if (ViewModel.IsBusy)
                    {
                        <div class="spinner-grow spinner-grow-sm text-primary" role="status"></div>
                    }
                    else
                    {
                         <button class="btn btn-light rounded-pill btn-sm px-4 text-muted fw-bold" @onclick="@(() => ViewModel.LoadMoreCommand.Execute(null))">
                            Load More
                        </button>
                    }
                </div>
            }
        </div>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await ViewModel.InitializeAsync();
    }
}
