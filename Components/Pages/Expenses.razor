@page "/expenses"
@using MauiHybridApp.ViewModels
@inject MauiHybridApp.ViewModels.ExpensesViewModel ViewModel

<PageHeader Title="My Expenses" />

<div class="page-content-container">
    
    <!-- Form Section -->
    <div class="card p-3 mb-4">
        <h5>New Expense</h5>
        <input type="date" class="form-control mb-2" @bind="ViewModel.NewExpense.ExpenseDate" />
        <input type="number" class="form-control mb-2" placeholder="Amount" @bind="ViewModel.NewExpense.Amount" />
        <input type="text" class="form-control mb-2" placeholder="Reason / Remarks" @bind="ViewModel.NewExpense.Remarks" />
        
        <button class="btn btn-primary w-100" @onclick="ViewModel.SubmitExpenseAsync" disabled="@ViewModel.IsLoading">
            @(ViewModel.IsLoading ? "Submitting..." : "Submit Claim")
        </button>
        
        @if (!string.IsNullOrEmpty(ViewModel.Message))
        {
            <div class="alert alert-info mt-2">@ViewModel.Message</div>
        }
    </div>

    <!-- List Section -->
    <h5>Recent History</h5>
    @if (ViewModel.IsLoading && ViewModel.Expenses.Count == 0)
    {
        <p>Loading history...</p>
    }
    else if (ViewModel.Expenses.Count == 0)
    {
        <p class="text-muted">No expenses found.</p>
    }
    else
    {
        @foreach (var item in ViewModel.Expenses)
        {
            <div class="expense-card">
                <div class="d-flex justify-content-between">
                    <strong>@item.Remarks</strong>
                    <span class="text-success fw-bold">@item.Amount.ToString("N2")</span>
                </div>
                <div class="text-muted small">@item.ExpenseDate.ToString("MMM dd, yyyy")</div>
            </div>
        }
    }
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        // Logic lives in the ViewModel
        await ViewModel.LoadExpensesAsync();
    }
}
