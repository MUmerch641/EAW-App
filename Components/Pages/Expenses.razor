@page "/expenses"
@using MauiHybridApp.ViewModels
@using MauiHybridApp.Components.Shared
@inject MauiHybridApp.ViewModels.ExpensesViewModel ViewModel

<div class="page-container scrollable">
    <PageHeader Title="My Expenses" IconClass="fa-money-bill-wave" />
    
    <div class="expenses-container">
        
        <!-- Form Section -->
        <div class="new-expense-card">
            <h5 class="card-title">New Expense Claim</h5>
            
            <div class="form-group">
                <input type="date" class="modern-input" @bind="ViewModel.NewExpense.ExpenseDate" />
            </div>
            
            <div class="form-group">
                <input type="number" class="modern-input" placeholder="Amount (e.g. 500.00)" @bind="ViewModel.NewExpense.Amount" />
            </div>
            
            <div class="form-group">
                <input type="text" class="modern-input" placeholder="Reason / Remarks" @bind="ViewModel.NewExpense.Remarks" />
            </div>
            
            <button class="btn-submit" @onclick="ViewModel.SubmitExpenseAsync" disabled="@ViewModel.IsLoading">
                @(ViewModel.IsLoading ? "Submitting..." : "Submit Claim")
            </button>
            
            @if (!string.IsNullOrEmpty(ViewModel.Message))
            {
                <div class="alert-box">
                    <i class="fas fa-info-circle"></i> @ViewModel.Message
                </div>
            }
        </div>

        <!-- List Section -->
        <div class="section-header">Recent History</div>
        
        @if (ViewModel.IsLoading && ViewModel.Expenses.Count == 0)
        {
            <div class="loading-text">Loading history...</div>
        }
        else if (ViewModel.Expenses.Count == 0)
        {
            <div class="empty-state">
                No recent expenses found.
            </div>
        }
        else
        {
            <div class="expense-list">
                @foreach (var item in ViewModel.Expenses)
                {
                    <div class="expense-card">
                        <div class="expense-info">
                            <span class="expense-remarks">@item.Remarks</span>
                            <span class="expense-date">@item.ExpenseDate.ToString("MMM dd, yyyy")</span>
                        </div>
                        <div class="expense-amount">
                            @item.Amount.ToString("N2")
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await ViewModel.LoadExpensesAsync();
    }
}
