@page "/walkthrough"
@inject MauiHybridApp.Services.Navigation.INavigationService NavigationService
@using MauiHybridApp.Services.Data
@inject ISettingsDataService SettingsService

<div class="page-container bg-white p-0">
    <div class="h-100 d-flex flex-column">
        
        <!-- Skip Button -->
        <div class="d-flex justify-content-end p-4">
            <button class="btn btn-link text-muted text-decoration-none fw-bold" @onclick="Skip">
                Skip
            </button>
        </div>

        <!-- Carousel Content -->
        <div class="flex-grow-1 d-flex flex-column align-items-center justify-content-center text-center p-4">
            
            <div class="mb-5 animate-fade-in" key="@CurrentSlide">
                <img src="@GetImageForSlide(CurrentSlide)" class="img-fluid mb-4" style="max-height: 250px;" alt="Walkthrough Image" />
                
                <h2 class="fw-bold text-dark mb-3">@GetTitleForSlide(CurrentSlide)</h2>
                <p class="text-muted px-4" style="min-height: 3rem;">
                    @GetDescriptionForSlide(CurrentSlide)
                </p>
            </div>

            <!-- Indicators -->
            <div class="d-flex gap-2 mb-5">
                @for (int i = 0; i < TotalSlides; i++)
                {
                    <div class="rounded-circle transition-all @(i == CurrentSlide ? "bg-primary" : "bg-light-gray")"
                         style="width: @(i == CurrentSlide ? "24px" : "8px"); height: 8px;"></div>
                }
            </div>

        </div>

        <!-- Bottom Action -->
        <div class="p-4 w-100">
            @if (CurrentSlide == TotalSlides - 1)
            {
                <button class="btn btn-primary w-100 rounded-pill py-3 fw-bold shadow-lg animate-fade-in-up" @onclick="Finish">
                    Get Started
                </button>
            }
            else
            {
                <button class="btn btn-primary w-100 rounded-pill py-3 fw-bold shadow-sm" @onclick="Next">
                    Next
                </button>
            }
        </div>
    </div>
</div>

<style>
    .bg-light-gray { background-color: #e0e0e0; }
    .transition-all { transition: all 0.3s ease; }
</style>

@code {
    private int CurrentSlide = 0;
    private const int TotalSlides = 3;

    private void Next()
    {
        if (CurrentSlide < TotalSlides - 1)
        {
            CurrentSlide++;
        }
    }

    private string GetTitleForSlide(int index) => index switch
    {
        0 => "Welcome to EatWork",
        1 => "Manage Your Time",
        2 => "Stay Connected",
        _ => ""
    };

    private string GetDescriptionForSlide(int index) => index switch
    {
        0 => "The easiest way to manage your HR needs on the go.",
        1 => "Track attendance, request leaves, and view payslips effortlessly.",
        2 => "Receive notifications and stay updated with company announcements.",
        _ => ""
    };

    private string GetImageForSlide(int index) => index switch
    {
        0 => "images/onboarding_1.svg", 
        1 => "images/onboarding_2.svg",
        2 => "images/onboarding_3.svg",
        _ => ""
    };

    private async Task Skip()
    {
        await Finish();
    }

    private async Task Finish()
    {
        // Mark walkthrough as seen (logic to be added to SettingsService)
        // await SettingsService.SetWalkthroughSeenAsync(true);
        await NavigationService.NavigateToAsync("/login"); // Or Dashboard if logged in
    }
}
